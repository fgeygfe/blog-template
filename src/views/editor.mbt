using @html {div, h1, p, button, text, input}
using @cmark_html { render }
using @dom {document}
///|
/// Markdown ç¼–è¾‘å™¨è§†å›¾ï¼ˆç®€ç‰ˆï¼‰ï¼šå·¦ä¾§è¾“å…¥ï¼Œå³ä¾§é¢„è§ˆ
pub fn view_editor(model : @types.Model) -> Html[@types.Msg] {
  let theme_bg = if model.dark_theme { "bg-gray-900" } else { "bg-gradient-to-br from-pink-100 to-white" }
  let card_bg = if model.dark_theme { "bg-gray-800" } else { "bg-white" }
  let text_color = if model.dark_theme { "text-white" } else { "text-gray-800" }
  let rendered = (try? render(safe=false, strict=true, model.markdown_content))
    .unwrap_or("")

// ç®€åŒ–é¢„è§ˆï¼šå…ˆä»¥çº¯æ–‡æœ¬å±•ç¤ºæ¸²æŸ“ç»“æœï¼ˆåç»­å¯æ›¿æ¢ä¸º external èŠ‚ç‚¹æŒ‚è½½ HTMLï¼‰

  div(class="min-h-screen " + theme_bg, [
    @component.navbar(model),
    div(class="pt-24 pb-16 px-4", [
      div(class="max-w-6xl mx-auto " + card_bg + " rounded-xl shadow-xl p-6", [
        h1(class="text-2xl font-bold mb-4 " + text_color, [text("ğŸ“ Markdown ç¼–è¾‘å™¨")]),
        div(class="flex flex-col md:flex-row gap-6", [
          // è¾“å…¥åŒº
          div(class="md:w-1/2 w-full", [
            p(class="mb-2 " + text_color, [text("è¾“å…¥å†…å®¹ï¼š")]),
          // è¿™é‡Œç”¨ input ä»£æ›¿ textareaï¼ˆrabbit-tea ç›®å‰æœªæä¾› textareaï¼‰ï¼Œå¯å¤šæ¬¡æ¢è¡Œç²˜è´´
          @html.input(class="w-full p-3 border rounded-lg min-h-[200px]", value=model.markdown_content, input=@types.Msg::UpdateMarkdown, children=[]),
            div(class="mt-4 flex gap-3", [
              button(
                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",
                click=@types.Msg::TogglePreview,
                [text(if model.preview_mode { "éšè—é¢„è§ˆ" } else { "æ˜¾ç¤ºé¢„è§ˆ" })],
              ),
              button(
                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",
                click=@types.Msg::SavePost,
                [text("ä¿å­˜")],
              ),
              button(
                class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",
                click=@types.Msg::CancelEdit,
                [text("å–æ¶ˆ")],
              ),
            ]),
          ]),
          // é¢„è§ˆåŒº
          div(class="md:w-1/2 w-full", [
            p(class="mb-2 " + text_color, [text("é¢„è§ˆï¼š")]),
            if model.preview_mode {
              div(class="p-4 border rounded-lg overflow-auto", [text(rendered)])
            } else {
              div(class="p-4 border rounded-lg text-gray-500", [text("ç‚¹å‡»â€œæ˜¾ç¤ºé¢„è§ˆâ€æŸ¥çœ‹æ¸²æŸ“ç»“æœ")])
            }
          ]),
        ]),
      ]),
    ]),
  ])
}


